<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Hexbin Map</title>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<script src="http://d3js.org/d3.hexbin.v0.min.js"></script>
	<script src="http://d3js.org/queue.v1.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<style type="text/css" media="screen">
	
	
	.accident {
		fill: orange;
		stroke: magenta;
	}
	
	.county{
		fill: gray;
		fill-opacity: 0.25;
		stroke: white;
	}
	
	.hexagon {
		fill: red;
		stroke: white;
	}
	
		.my-legend {
			position: absolute;
			top: 550px;	
			left: 775px;
		
	  	}
	
			.my-legend .legend-title {
		    text-align: left;
		    margin-bottom: 8px;
		    font-weight: 300;
		    font-size: 90%;
				font-family: "Helevetica Neue", sans-serif;
		    }
	  
	  .my-legend .legend-scale ul {
	    margin: 0;
	    padding: 0;
	    float: left;
	    list-style: none;
	    }
	  .my-legend .legend-scale ul li {
	    display: block;
	    float: left;
	    width: 50px;
			
	    margin-bottom: 6px;
	    text-align: left;
	    font-size: 60%;
	    list-style: none;
	    }
	  .my-legend ul.legend-labels li span {
	    display: block;
	    float: left;
	    height: 15px;
	    width: 50px;
			font-size: 90%;
			font-family: "Helevetica Neue", sans-serif;
	    }
	  .my-legend a {
	    color: #777;
	    }
	
	.words{
		display: inline-block;
		height: 100px;
		width: 550px;
		float: left;
		margin-left: 50px;
		
	}
	
	#title{
		color: steelblue;
		font-size: 33px;
		font-family: "Helvetica Neue", sans-serif;
		font-weight: 300;
		letter-spacing: -1px;

	}
	#title span{
		/*left: 100px;*/
		position: relative;
		left: 150px;
		/*width: 600px;
				height: 100px;
				left: 0px;*/
	}
		
	#text{
		font-family: "Helvetica Neue", sans-serif;
		line-height: 25px;
	}	
	
	#map1{
		position: absolute;
		top: 800px;
		left: 850px;
	}
	
	#map2{
		display: inline-block;
		float: left;
		left: 50px;
		
	}
	
	#title_map2{
		font-family:"Helvetica Neue", sans-serif;
		font-weight: bold;
		left: 50px;
		position: relative;
		color: steelblue;
	}
	
	#graycrosses{
		font-weight: 300;
		font-size: 15px;
		color: black;
	}
	#circles{
		color:#a82e55 ;
	}
		
	</style>
</head>
<body>
	
	<div class="words">
		<h1 id="title">San Francisco Bicycle Injury Accidents<span><br> 2000 - 2011</br></span> </h1> 
		<p id="text">The number of bicycle-injury accidents in San Francisco increased 55 percent between 2000 and 2011 with the highest number of crashes occurring in 2010 with 629. Most of the crashes occurred on Market, Mission and Valencia streets. Crashes occurred most often at intersections and during commuting hours around 8:30 a.m. or 6 p.m. <br><br>

		Of the 5133 crashes recorded during this time period, 26 resulted in fatalities. <br><br>

		Crashes occurred slightly more frequently on Thursday than any other day of the week and more often than not, on clear or slightly cloudy days with normal road conditions. <br><br>

		About half of the time, bicyclists are at fault for the crash. The other half, drivers are at fault. Below is graph showing the percent change of who is at fault in bicycle-injury crashes, according to data compiled from San Francisco police reports. 
		 </p>
	</div>
	
	<script type="text/javascript" charset="utf-8">
		
var margin = {top: 20, right: 20, bottom: 20, left: 20}
		width  = 750 - margin.left - margin.right, 
		height = 700 - margin.top - margin.bottom;
		
var color = d3.scale.linear()
		.domain([0, 150])
		.range(["steelblue", "#AB2B52"]);
		
var hexbin = d3.hexbin()
		.size([width, height])
		.x(function(d) { return d.px; })
		.y(function(d) { return d.py; })
		.radius(12);
	
var radius = d3.scale.sqrt()
		.domain([0, 50])
		.range([0, 8]);	

var projection = d3.geo.albers()
	  .scale(1000)
	  .translate([width / 2, height / 2])
	  .precision(.1);
		
var path = d3.geo.path()
		.projection(projection);	

var svg = d3.select("body").append("svg")
		.attr("width", width)
		.attr("height", height)
		.append('g')
		.attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');

queue()
	.defer(d3.csv, "dataWithLatLon.csv")
	.defer(d3.json, "planning_neighborhoods.geojson")
	.await(ready);
	
function ready (error, bike, sf) {
	
	//now we need a projection
  var projection = d3.geo.mercator()
		  .translate([width / 2, height / 2])
			.center([-122.4453, 37.7422])
		  .scale(200000);
		
	bike.forEach(function(d) {
		d.lat = +d.lat;
		d.lon = +d.lon;
		var p = projection([d.lat, d.lon]);
		d.px = p[0];
		d.py = p[1];
	})
	
  //and now to create a path that draws the data on the projection
  var path = d3.geo.path()
		   .projection(projection);

	 svg.selectAll(".county")
       .data(sf.features)
       .enter().append("path")
       .attr("class", "county")
       .attr("d", path)
       // .style("stroke", "red");

		// var accident = svg.selectAll(".accident")
		// 		.data(bike)
		// 	.enter().append("circle")
		// 		.attr("class", "accident")
		// 		.attr("r", 3)
		// 		.attr("transform", function(d) { return "translate(" + d.px + "," + d.py + ")"; })
				
		var hexagonGroup = svg.append('g')
				 		.attr("class", "hexagons");
				
		hexagonGroup.selectAll('.hexagon')
						.data(hexbin(bike))
						.enter().append('path')
						.attr("class", "hexagon")
						.attr('d', function (d) {return hexbin.hexagon(radius(d.length));})
						.attr("transform", function(d) {return "translate(" + d.x + "," + d.y + ")";})
						.on("mouseover", function(d) { console.log(d.length); })	
						.style("fill", function(d) {return color( d.length ); })
}

</script>

	

<div class="my-legend">
	<div class='legend-title'>Number of crashes</div>
	<div class='legend-scale'>
	  <ul class='legend-labels'>
	    <li><span style='background:#4880b2;'></span>0</li>
			<li><span style='background:#5377a8;'></span>20</li>
			<li><span style='background:#616b9a;'></span>40</li>
	    <li><span style='background:#6e608d;'></span>60</li>
	    <li><span style='background:#7b5581;'></span>80</li> 
	   	<li><span style='background:#894873;'></span>100</li>
			<li><span style='background:#973c65;'></span>120</li>
	    <li><span style='background:#9e365e;'></span>130</li>
			<li><span style='background:#a82e55;'></span>150</li>
	  </ul>
	</div>
</div>	

<div id="map1"> 
	<img src="maps/20131209_AtFault_Final.png" width="400" height="400" alt="20131209 AtFault Final">
	<img src="maps/legend_at_Fault_rate.png" width="150" height="200" alt="Legend At Fault Rate">
</div>

<div id="map2">
	<p id="title_map2"> Bicycle Fatalities <br><span id="graycrosses"> The gray crosses represent all of the San Francisco bicycle-injury crashes between 2000 and 2011. 
		<br>The <span	id="circles">red circles</span> indicate the crashes that resulted in a fatality. </span></p> 
	<img src="maps/Bicycle Fatalities Mapped copy.png" width="660" height="630" alt="Bicycle Fatalities Mapped Copy">
</div>
	
		
	
</body>
</html>



